<!-- MHonArc v2.6.16 -->
<!--X-Subject: [tlug] Getting a client and server to agree on UTC time -->
<!--X-From-R13: Rnir [ U <qnirNnegvpynff.bet> -->
<!--X-Date: Sun, 19 Dec 2010 15:32:54 +0900 -->
<!--X-Message-Id: 4D0DA713.7060006@articlass.org -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00134.html">Date Prev</a>][<a href="msg00136.html">Date Next</a>][<a href="msg00127.html">Thread Prev</a>][<a href="msg00136.html">Thread Next</a>][<a href="maillist.html#00135">Date Index</a>][<a href="threads.html#00135">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[tlug] Getting a client and server to agree on UTC time</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Sun, 19 Dec 2010 15:32:51 +0900</li>
<li><strong>From</strong>: <strong>Dave M G &lt;<a href="mailto:dave@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Getting%20a%20client%20and%20server%20to%20agree%20on%20UTC%20time">dave@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>[tlug] Getting a client and server to agree on UTC time</strong></li>
<li>User-agent: Mozilla/5.0 (X11; U; Linux i686; en-US;	rv:1.9.2.13) Gecko/20101208 Thunderbird/3.1.7</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>TLUG,

I'm writing a Javascript  application that talks to a PHP/MySQL server,
and I need them to conform to using UTC time so that users across time
zones can see information about other user's time without having to know
what time zone each other is in.

I display to the user everything time related in their local time, but
that's only when displaying. Behind the scenes, everything is converted
to UTC.

I use a Unix time stamp, stored as a ten digit number in MySQL (not as a
DATE field). I do all the time calculating within the PHP and Javascript
code. Accuracy to seconds is good enough, so on the Javascript end, I
convert from miliseconds to seconds.

Here's the code I use to get the UTC time on the Javascript side:
function convertLocalToUTC(timeInput)
{
    return timeInput + (new Date().getTimezoneOffset() * 60);
}

The variable &quot;timeinput&quot; is a ten digit Unix time stamp. Theoretically,
the Date().getImtezoneOffset() returns the number of minutes difference
between now and UTC. Multiplying it by 60 turns it into seconds, and can
be added to the number of seconds in the Unix time stamp.

Here's the code I use to get the UTC time on the PHP side.
$utcTime = time() - date(&quot;Z&quot;);

When I test on my local machine, everything works. But when I upload the
PHP to a remote server (hosted in Boston), the times begin to disagree.
They're off by a few hours.

I think that my math is correct, so long as I'm working on the right
assumptions about what UTC time values I should be getting back from
date(&quot;Z&quot;) and getTimezoneOffset. However, since things aren't working as
expected, my understanding of what those return must not be right.

Of course, I've looked up on online guides and the PHP manual, but what
I've read is what lead me to believe these should work in the first place.

Can anyone point out where I'm going wrong?

Any advice would be much appreciated.

--
Dave M G

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00136" href="msg00136.html">Re: [tlug] Getting a client and server to agree on UTC time</a></strong>
<ul><li><em>From:</em> Edmund Edgar</li></ul></li>
<li><strong><a name="00137" href="msg00137.html">Re: [tlug] Getting a client and server to agree on UTC time</a></strong>
<ul><li><em>From:</em> Darren Cook</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00134.html">Re: [tlug] Javascript and I have different ideas about what &quot;concatenate&quot; means. [SOLVED]</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00136.html">Re: [tlug] Getting a client and server to agree on UTC time</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00127.html">[tlug] Japan</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00136.html">Re: [tlug] Getting a client and server to agree on UTC time</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00135"><strong>Date</strong></a></li>
<li><a href="threads.html#00135"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="/list.html"> Mailing List </a></td>
<td align=center><a href="http://tlug.jp/linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="http://tlug.jp/members.html">TLUG Members</a></td>
<td align=center><a href="http://tlug.jp//linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
