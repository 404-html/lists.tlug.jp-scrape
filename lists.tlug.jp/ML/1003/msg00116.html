<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [tlug] state of the art spam filtering -->
<!--X-From-R13: Oggvyn Yvanyv <nggvynNxvanyv.pu> -->
<!--X-Date: Thu, 18 Mar 2010 20:04:27 +0900 -->
<!--X-Message-Id: 20100318120353.f66ca1e0.attila@kinali.ch -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20100316092524.c153a4a9.attila@kinali.ch -->
<!--X-Reference: 20100316104829.GL4400@poetic.cynic.net -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00115.html">Date Prev</a>][<a href="msg00117.html">Date Next</a>][<a href="msg00108.html">Thread Prev</a>][<a href="msg00134.html">Thread Next</a>][<a href="maillist.html#00116">Date Index</a>][<a href="threads.html#00116">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [tlug] state of the art spam filtering</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Thu, 18 Mar 2010 12:03:53 +0100</li>
<li><strong>From</strong>: <strong>Attila Kinali &lt;<a href="mailto:attila@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20state%20of%20the%20art%20spam%20filtering">attila@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [tlug] state of the art spam filtering</strong></li>
<li>References: &lt;<a href="mailto:20100316092524.c153a4a9.attila@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20state%20of%20the%20art%20spam%20filtering">20100316092524.c153a4a9.attila@example.com</a>&gt;	&lt;<a href="mailto:20100316104829.GL4400@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20state%20of%20the%20art%20spam%20filtering">20100316104829.GL4400@example.com</a>&gt;</li>
<li>Organization: NERV</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Tue, 16 Mar 2010 19:48:29 +0900
Curt Sampson &lt;cjs@example.com&gt; wrote:

&gt; On 2010-03-16 09:25 +0100 (Tue), Attila Kinali wrote:
&gt; 
&gt; &gt; ...on both primary and secondary MX...
&gt; 
&gt; Can you define what you mean by &quot;primary&quot; and &quot;secondary&quot; MX? Is there
&gt; actually any difference between these servers, besides the priority in
&gt; the DNS?

primary is for me the one MX on which the mails should end up.
That can be the server which runs the mailinglist software, the
one that is doing the local delivery, the one that puts it into
an IMAP server or the one that decides that it is forwarded to
a different address.

secondary are for me the backup MX which store the mails in case
the primary is not reachable for a certain amount of time.

&gt; I didn't mention it when I was talking about my configuration, but in
&gt; that case it's perfectly reasonable to run all of one's servers at the
&gt; same priority.

In most circumstances it doesn't really matter. If the primary is running
and the mail is send to a secondary, the delay caused by this is less
than a minute, if not just a second or two.
 
&gt; &gt; My current setup for the high-volume domains is to have strict
&gt; &gt; envelope-from/envelope-to checking... and reject everything with a
&gt; &gt; 4xx that has an invalid envelope-from, resp 5xx if the envelope-to is
&gt; &gt; invalid.
&gt; 
&gt; Well, everybody needs to reject things with an invalid envelope-to. What
&gt; are you going to do with it if you accept it? :-)

By default, quite a few MTA software accept invalid envelope-to's if
they are secondary for a domain.
 
&gt; But how do you define an &quot;invalid&quot; envelope-from? As we've seen in
&gt; other things that have come up on the list, validity changes from
&gt; place to place and time to time. And while there are various checks
&gt; you can try to do, none of these guarantee that the address can
&gt; actually be delivered. 

I do a reverse delivery check. Ie the MTA tries whether the envelope-from
can be reached _and_ accepts mails. The result of this test is cached
in a local database. 

&gt; Further, much spam these days does have a
&gt; valid envelope-from, it's just some random valid address the spammer
&gt; &quot;borrowed&quot; from some poor sod who's going to have to deal with all of
&gt; the blowback.

It actually causes problems even if it's not valid. We got a complaint
from one of the big free email providers in france, that we are creating
a considerable load on his servers due to the amount of checks we are
performing (a lot of spamers are using that domain with some valid/invalid
user part). I don't know yet how to solve this issue.

In case the email address is valid. We will not bounce once the mail has
been accepted. This means that everything that might cause the mail to
bounce has to be checked before the DATA command is finished, so that we
know that the mail is deliverable with 99.9% certainty.  It also means
that the spamfilter that is applied much later, does not bounce. It will
tag the mail, quarantine it, eat it,... but never bounce.

&gt; &gt; A nice and cheap filter that also catches quite a lot is the
&gt; &gt; requirement to have a valid FQDN in HELO/EHLO (though it does not have
&gt; &gt; to resolve).
&gt; 
&gt; If it doesn't resolve, how do you know that it's a valid FQDN? By the
&gt; RFC standards, , &quot;mail.yahoo.com&quot; is not an *F*QDN because it doesn't
&gt; end with a period. (&quot;mail.yahoo.com.&quot; would be an FQDN.) But most SMTP
&gt; delivery agents don't fully qualify their HELO name with a period.
&gt; Conversely, since &quot;blah.&quot; is an FQDN (even though it doesn't resolve),
&gt; and &quot;com.&quot; is (and even does resolve, albeit only to NS records) by that
&gt; standard you'd need to accept &quot;HELO blah&quot; and &quot;HELO com&quot;.

Uh.. i let postfix decide that :-)
I think it checks whether the FQDN matches a certain regexp and the
TLD is valid. The reason why i do not resolve the FQDN is, that i
don't want to disallow people with home machines, that do not have
a fix IP and hence do not resolve its name to an IP to send mails.
Ofcourse, the envelope-from has to be valid :)

&gt; I have a limited set of local access lists which are used as much for
&gt; allowing things as denying them, a handful of header and body checks
&gt; that are only there to get rid of the most egregious stuff, and for
&gt; the rest I rely on the following SMTP client RBLs, which have done an
&gt; excellent job for me:
&gt; 
&gt;     sbl-xbl.spamhaus.org
&gt;     bl.spamcop.net
&gt;     dul.dnsbl.sorbs.net
&gt;     web.dnsbl.sorbs.net
&gt;     socks.dnsbl.sorbs.net

As i said in my previous mail, i dont think RBLs are a good solution
as they catch also legitimate users (especially me ;-).

&gt; That still leaves me with a hundred to two hundred spams per day, all
&gt; but a few per week of which are caught by spamprobe, which is a Baysean
&gt; filter.

The MTA level checks we perform on the MPlayer/FFmpeg mail server reject
in average one mail(spam) every 10s. Spamassassin catches a spam mail
every 1.5min. This is about 8000-9000 rejects and about 1000 spam catches
a day. In comparison, we receive about 5000 &quot;legitimate&quot; mail per day.

My private mail server doesn't do such rigorous MTA level checks and hence
i get about 200-500 spam mails per day on my personal account (to about 200-300
legitmiate mails).

			Attila Kinali

-- 
If you want to walk fast, walk alone.
If you want to walk far, walk together.
		-- African proverb

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00134" href="msg00134.html">Re: [tlug] state of the art filtering</a></strong>
<ul><li><em>From:</em> Tobias Diedrich</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00085" href="msg00085.html">[tlug] state of the art spam filtering</a></strong>
<ul><li><em>From:</em> Attila Kinali</li></ul></li>
<li><strong><a name="00108" href="msg00108.html">Re: [tlug] state of the art spam filtering</a></strong>
<ul><li><em>From:</em> Curt Sampson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00115.html">Re: [tlug] state of the art spam filtering</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00117.html">Re: [tlug] state of the art spam filtering</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00108.html">Re: [tlug] state of the art spam filtering</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00134.html">Re: [tlug] state of the art filtering</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00116"><strong>Date</strong></a></li>
<li><a href="threads.html#00116"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="/list.html"> Mailing List </a></td>
<td align=center><a href="http://tlug.jp/linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="http://tlug.jp/members.html">TLUG Members</a></td>
<td align=center><a href="http://tlug.jp//linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
