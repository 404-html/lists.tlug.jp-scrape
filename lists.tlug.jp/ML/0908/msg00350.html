<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [tlug] migrating Japanese filenames from old to new samba server -->
<!--X-From-R13: [vpurny Qbbcre <pbbcre.zrNtznvy.pbz> -->
<!--X-Date: Fri, 21 Aug 2009 21:06:55 +0900 -->
<!--X-Message-Id: f91aa3d0908210459g5f997bedvaf556940574ec728@mail.gmail.com -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Reference: f91aa3d0908210202u697bfd2fm50495984882d49b@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00349.html">Date Prev</a>][<a href="msg00351.html">Date Next</a>][<a href="msg00348.html">Thread Prev</a>][<a href="msg00356.html">Thread Next</a>][<a href="maillist.html#00350">Date Index</a>][<a href="threads.html#00350">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [tlug] migrating Japanese filenames from old to new samba server</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Fri, 21 Aug 2009 20:59:37 +0900</li>
<li><strong>From</strong>: <strong>Micheal Cooper &lt;<a href="mailto:cooper.me@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20migrating%20Japanese%20filenames%20from%20old%20to%20new%20samba%20server">cooper.me@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [tlug] migrating Japanese filenames from old to new samba server</strong></li>
<li>References: &lt;<a href="mailto:f91aa3d0908210202u697bfd2fm50495984882d49b@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20migrating%20Japanese%20filenames%20from%20old%20to%20new%20samba%20server">f91aa3d0908210202u697bfd2fm50495984882d49b@example.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div class="gmail_quote">On Fri, Aug 21, 2009 at 6:02 PM, Micheal Cooper <span dir="ltr">&lt;<a rel="nofollow" href="mailto:cooper.me@example.com">cooper.me@example.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
- 1 - I am sure someone has experience with this situation. What would be the best way to bring the old file server files over to the new machine so that I can manipulate the Japanese-named files through the command line? My initial plan was to rsync them over with ownership, groups, etc. intact. I have already prepared lists of usernames and directories to get it done.<br>

- 2 - Should I change the &#39;dos charset&#39; and/or the &#39;unix charset&#39; in the smb.conf of the new RHEL5 file server? CP850 is western characters only, and even Microsoft claims to not support it any longer. On the other hand, it is working really well, so obviously I don&#39;t understand well enough. If the &#39;dos charset&#39; is CP850, shouldn&#39;t the server be spitting out garbled filenames to the MacOSX and the WinXPJA clients? The filesystem is Unicode, right? And Samba 3 can speak Unicode, so shouldn&#39;t I have to set the &#39;dos charset&#39; to utf-8, too?</blockquote>
<div><br><blockquote><blockquote style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;" class="gmail_quote"> ---------- Forwarded message ----------<br>From: Edmund Edgar &lt;<a rel="nofollow" href="mailto:lists@example.com">lists@example.com</a>&gt;<br>
To: Tokyo Linux Users Group &lt;<a rel="nofollow" href="mailto:tlug@example.com">tlug@example.com</a>&gt;<br>Date: Fri, 21 Aug 2009 18:33:02 +0900<br>Subject: Re: [tlug] migrating Japanese filenames from old to new samba server<br><br>
You should be able to do something like<br>
rsync -avz --delete --iconv=cp850,utf8<br>
oldserver:/path/to/fileserver/stuff<br>
newserver:/path/to/fileserver/stuff/<br></blockquote></blockquote><div id=":7r" class="ii gt"><br>Thank you very much for the info. <br><br>The charset in old file server smb.conf is cp932 for dos_charset and unix_charset.<br>
<br>The newer version (v 3.01) of rsync can do &#39;--iconv=UTF-8&#39; to convert charset as it copies, but RHEL5 has version 2.6, so I tried using convmv first.<br><br>Downloaded convmv from rhttp://<a rel="nofollow" href="http://dag.wieers.com/rpm/packages/convmv/">dag.wieers.com/rpm/packages/convmv/</a> and installed.<br>
&#39;convmv --list&#39; confirmed that convmv can convert from cp932.<br><br>------ Did some testing and tweaking ------<br>  1. Logout and login WinXP.<br>  2. Umount the share from MacOSX.<br>  3. rsync -a --delete --numeric-ids sekai:/home/users/staff/Common/shisetu_setsubi /srv/samba/share/test<br>
  4. That worked well.<br>  5. convmv -f cp932 -t utf-8 /srv/samba/share -r --notest<br>  6. Works really well.<br>  7. vi /etc/samba/smb.conf<br>  8. [global]<br>  9.         dos charset = UTF8<br>  10.         unix charset = UTF8<br>
  11.         display charset = UTF8<br>  12. service smb restart<br><br>Connected with XP and OSX again, wrote, read, modified... it still works wonderfully. I get no mojibake on iTerm from my Mac, none from the XP, none from the mounted share in Mac Finder, and none from the Linux terminal in X on the file server itself.<br>
<br>This was a very positive experience. Thank you for the input. I am so greatful for convmv, and of course for TLUG, too. Great stuff.<br><br>Notes: Read the convmv man page carefully. Recursion is not default, and neither is actually changing the names. You have to use --notest to actually change anything. Otherwise, it just tells you what it would do. Excellent software.<br>
<br>So I am going home for some rest. Thanks again.<br><br></div></div></div>-- <br>Micheal Cooper<br>Miyazaki, Japan (GMT+9, no DST)<br>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00345" href="msg00345.html">[tlug] migrating Japanese filenames from old to new samba server</a></strong>
<ul><li><em>From:</em> Micheal Cooper</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00349.html">Re: [tlug] Unix's 40th Birthday</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00351.html">Re: [tlug] Unix's 40th Birthday</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00348.html">Re: [tlug] migrating Japanese filenames from old to new samba server</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00356.html">[tlug] old and obscure problem with the gcc compiler</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00350"><strong>Date</strong></a></li>
<li><a href="threads.html#00350"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="/list.html"> Mailing List </a></td>
<td align=center><a href="http://tlug.jp/linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="http://tlug.jp/members.html">TLUG Members</a></td>
<td align=center><a href="http://tlug.jp//linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
