<!-- MHonArc v2.2.0 -->
<!--X-Subject: Re: tlug: Problems with 3Com 3C575&#45;TX -->
<!--X-From: "Manuel M. T. Chakravarty" <chak@example.com> -->
<!--X-Date:  Tue, 15 Dec 1998 01:40:58 +0900 -->
<!--X-Message-Id: 19981215011511J.chak@example.com -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: Pine.LNX.3.96LJ1.1b7.981214150429.17300M&#45;100000@example.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-type" content="text/html">
  <meta name="Author" content="Jim Schweizer - webmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<!--X-Body-Begin-->
<!--X-User-Header-->
<P>
<font color="blue">
Support open source code!
</font>
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00323.html">Date Prev</A>][<A HREF="msg00325.html">Date Next</A>][<A HREF="msg00320.html">Thread Prev</A>][<A HREF="msg00328.html">Thread Next</A>][<A HREF="maillist.html#00324">Date Index</A>][<A HREF="threads.html#00324">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>Re: tlug: Problems with 3Com 3C575-TX</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong><A HREF="mailto:tlug@example.com">tlug@example.com</A>, <A HREF="mailto:sstone@example.com">sstone@example.com</A></strong></LI>
<LI><strong>Subject</strong>: <strong>Re: tlug: Problems with 3Com 3C575-TX</strong></LI>
<LI><strong>From</strong>: <strong>"Manuel M. T. Chakravarty" &lt;<A HREF="mailto:chak@example.com">chak@example.com</A>&gt;</strong></LI>
<LI>Date: Tue, 15 Dec 1998 01:15:11 +0900</LI>
<LI>Content-Transfer-Encoding: 7bit</LI>
<LI>Content-Type: Text/Plain; charset=us-ascii</LI>
<LI>In-Reply-To: Your message of "Mon, 14 Dec 1998 15:05:28 +0900 (JST)"&lt;<A HREF="msg00320.html">Pine.LNX.3.96LJ1.1b7.981214150429.17300M-100000@example.com</A>&gt;</LI>
<LI>References: &lt;<A HREF="msg00320.html">Pine.LNX.3.96LJ1.1b7.981214150429.17300M-100000@example.com</A>&gt;</LI>
<LI>Reply-To: <A HREF="mailto:tlug@example.com">tlug@example.com</A></LI>
<LI>Sender: <A HREF="mailto:owner-tlug@example.com">owner-tlug@example.com</A></LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
Scott Stone &lt;sstone@example.com&gt; wrote,

&gt; On Mon, 14 Dec 1998, Manuel M. T. Chakravarty wrote:
&gt; 
&gt; &gt; Hi!
&gt; &gt; 
&gt; &gt; I am trying to get 3Com's 3C575-TX FastEthernet CardBus PCMCIA
&gt; &gt; card working in my VAIO PC-505 notebook.  I am running
&gt; &gt; TurboLinux 3.0J's APM kernel version 2.0.36 with
&gt; &gt; kernel-pcmcia-cs version 3.0.6.
&gt; &gt; 
&gt; &gt; When I put the card in the slot, it is recognized,
&gt; &gt; initialized, and the network settings are correctly set up.
&gt; &gt; I can ping the card with its own IP address, but I cannot
&gt; &gt; reach anything else.  Even worse when I eject the card, the
&gt; &gt; PCMCIA software is in a strange state and doesn't accept any 
&gt; &gt; other (non-CardBus) cards anymore; and if I try, it sometimes 
&gt; &gt; locks up the whole machine.
&gt; &gt; 
&gt; &gt; The driver is Donald Becker's 3c575_cb version 0.99H from 11/17/98.
&gt; &gt; 
&gt; &gt; I am pretty sure it is a interrupt problem for two reasons:
&gt; &gt; 
&gt; &gt; (1) Sometimes when I try to access the network via the
&gt; &gt;     CardBus card I get a message in /var/log/messages saying
&gt; &gt;     `Interrupt posted but not delivered -- IRQ blocked by
&gt; &gt;     another device?'
&gt; 
&gt; after loading the card, cat /var/run/stab - what IRQ is it using?  You can
&gt; edit the stuff under /etc/pcmcia to tell it to exclude certain IRQs as
&gt; well.

Hmmm, /var/run/stab doesn't list the IRQ as far as I see,
but according to /proc/interrupts IRQ 10 is used.  

&gt; &gt; Chris Sekiya &lt;chris@example.com&gt; wrote,
&gt; &gt; 
&gt; &gt; &gt; On Mon, 14 Dec 1998, Manuel M. T. Chakravarty wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; However, the interrupt that is assigned to the card (IRQ 10) 
&gt; &gt; &gt; &gt; is *free* - it is used sucessfully by my older non-CardBus
&gt; &gt; &gt; &gt; PCMCIA Ethernet card.
&gt; &gt; &gt; 
&gt; &gt; &gt; Isn't IRQ10 commonly used by PCMCIA host adaptors?  ISTR that my
&gt; &gt; &gt; (currently dead) laptop's Cirrus controller sat at IRQ10.
&gt; &gt; 
&gt; &gt; Hmm, but then it shouldn't work with the other card also,
&gt; &gt; should't it?  Anyway, thanks for the comment, I will check
&gt; &gt; that again!
&gt; 
&gt; BTW, David Hinds, author of pcmcia-cs, does respond to email usually.  I
&gt; say though that you should try telling it to exclude IRQ10 just in case.

I tried it.  Then, IRQ 11 is used with identical results.

However, I made some more experiments, which gave some vage
clues:

(1) I could reproduce the fatal freezing of the machine.  It 
    happens if I insert the CardBus card again after ejecting 
    it once.

(2) Similarly, whenever I insert the non-CardBus PCMCIA card 
    after I ejected the CardBus card, the machine also
    freezes, but unlocks when ejecting the card again (this
    is not the case for (1)).

So, ejecting the CardBus card leaves the machine in a
strange state.  

(3) After suspending and reactivating the machine, the
    strange state is still present, *but* after hibernation, 
    the machine seems to be reset and the non-CardBus card
    works again.

This can have two reasons:

(a) The strange state is `stored' in the hardware, which is
    of course fully reset after hibernation or

(b) the strange state is in a part of the software that goes
    through an additional resume cycle after a hibernation.

I think the PCMCIA hardware is already powered down during a
suspend and it doesn't seem very likely that any other part of
the hardware stores the strange state, right?  This leaves
us mainly with `ds.c' and `pcmcia_core.c' (all other related
modules are unloaded when I eject the CardBus card) - and
the (scary) possibility that some kernel table is screwed up 
(if so, probably due to a bug in a module and not the kernel 
itself).

Does anybody know whether anything (maybe in the kernel) is
reset after hibernation - cf. reason (b) above?

A brief look into `ds.c' suggests that it doesn't make a
distinction between CardBus and non-CardBus cards.
Furthermore, the actual card driver communicates with the
rest of the PCMCIA modules only via the `cb_enabler' module
(judging from `lsmod').  Hmmm, it looks like maybe the
`cb_enabler' module triggers an event that then screws
something up in `pcmcia_core'...does this make sense?

Any ideas apart from compiling the modules with debugging
enabled?

Anyhow, thanks for listening...aehmm...reading.  It is late
now and I go to bed,

Manuel

P.S.: Interesting aside: `cb_enabler.c' can be compiled not
      only for Linux, but also for BeOS (if we believe the
      preprocessor directives)...maybe that is the reason
      why pcmcia-cs comes with the MPL and not the GPL...
------------------------------------------------------------------
Next Nomikai: 15 January 1999, 19:30 Tengu TokyoEkiMae 03-3275-3691
Next Technical Meeting: 13 February, 12:30               Place: TBD
------------------------------------------------------------------
more info: <A TARGET="_top" HREF="http://tlug.linux.or.jp">http://tlug.linux.or.jp</A>                     Sponsor: PHT

</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00328" HREF="msg00328.html">Re: tlug: Problems with 3Com 3C575-TX</A></STRONG>
<UL><LI><EM>From:</EM> Scott Stone &lt;sstone@example.com&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00320" HREF="msg00320.html">Re: tlug: Problems with 3Com 3C575-TX</A></STRONG>
<UL><LI><EM>From:</EM> Scott Stone &lt;sstone@example.com&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00323.html">Re: tlug: Network card not found</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00325.html">Re: tlug: PC-NFS, samba?</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00320.html">Re: tlug: Problems with 3Com 3C575-TX</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00328.html">Re: tlug: Problems with 3Com 3C575-TX</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="maillist.html#00324"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00324"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="../../list.html"> Mailing List </a></td>
<td align=center><a href="../../linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="../../members.html">TLUG Members</a></td>
<td align=center><a href="../../linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
