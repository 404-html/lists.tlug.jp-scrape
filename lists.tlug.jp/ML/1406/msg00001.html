<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [tlug] Limits on file numbers in sort &#45;m -->
<!--X-From-R13: Fenivf Qneqjryy <genivf.pneqjryyNrkgryyvflf.pbz> -->
<!--X-Date: Sun, 01 Jun 2014 15:14:29 +0900 -->
<!--X-Message-Id: 538AC4BF.3050903@extellisys.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: CABHGxq7jYkDDLkF8uzzNK8WeU+37t1wgpVhk6VD2HQKyEi7wBw@mail.gmail.com -->
<!--X-Reference: CAJMSLH618MfmhL9ufAOfLXxw52i4STpF8dsc_+xe&#45;2GRB3JM8g@mail.gmail.com -->
<!--X-Reference: 87bnui8sky.fsf@uwakimon.sk.tsukuba.ac.jp -->
<!--X-Reference: CABHGxq4NEBMVR8jndiEvcgsGkc_B0f&#45;qcrs2sFjqaAdWH3n9sw@mail.gmail.com -->
<!--X-Reference: CAJMSLH6SdSUmvHsjmZBZP&#45;g1graNuPV51vdwLzpPf7ipmz7+zA@mail.gmail.com -->
<!--X-Reference: CABHGxq7eCk9Pk1JtNrZuqK_8yv4bt7ftoWwyXqf5P+GKYQH=5w@mail.gmail.com -->
<!--X-Reference: 87sins7mhy.fsf@uwakimon.sk.tsukuba.ac.jp -->
<!--X-Reference: CAJA1Y2b6XyFNsFhDbK+ktgWk0cE5Lzfv9OrhimBH8RyN78yzLQ@mail.gmail.com -->
<!--X-Reference: 87d2ew76yd.fsf@uwakimon.sk.tsukuba.ac.jp -->
<!--X-Reference: CAJA1Y2Y2vaH06nJyt25uREjCT9RELoTnfwDpeXX5Z97W45oZUQ@mail.gmail.com -->
<!--X-Reference: 5387D422.2070302@extellisys.com -->
<!--X-Reference: CABHGxq65zdPuC1dRof0_KjmEzuNFX2GKS3JpjJM7T&#45;U=2PH2Tw@mail.gmail.com -->
<!--X-Reference: CAJA1Y2YvJikn77rv3EznP=UC4nr8rT4L07RauCN7Kv3tYqD5Ew@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00000.html">Date Prev</a>][<a href="msg00002.html">Date Next</a>][<a href="msg00014.html">Thread Prev</a>][<a href="msg00018.html">Thread Next</a>][<a href="maillist.html#00001">Date Index</a>][<a href="threads.html#00001">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [tlug] Limits on file numbers in sort -m</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Sun, 01 Jun 2014 15:14:23 +0900</li>
<li><strong>From</strong>: <strong>Travis Cardwell &lt;<a href="mailto:travis.cardwell@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Limits%20on%20file%20numbers%20in%20sort%20-m">travis.cardwell@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [tlug] Limits on file numbers in sort -m</strong></li>
<li>References: &lt;CABHGxq7jYkDDLkF8uzzNK8WeU+37t1wgpVhk6VD2HQKyEi7wBw@mail.gmail.com&gt;	&lt;CAJMSLH618MfmhL9ufAOfLXxw52i4STpF8dsc_+xe-2GRB3JM8g@mail.gmail.com&gt;	&lt;87bnui8sky.fsf@uwakimon.sk.tsukuba.ac.jp&gt;	&lt;CABHGxq4NEBMVR8jndiEvcgsGkc_B0f-qcrs2sFjqaAdWH3n9sw@mail.gmail.com&gt;	&lt;CAJMSLH6SdSUmvHsjmZBZP-g1graNuPV51vdwLzpPf7ipmz7+zA@mail.gmail.com&gt;	&lt;CABHGxq7eCk9Pk1JtNrZuqK_8yv4bt7ftoWwyXqf5P+GKYQH=5w@mail.gmail.com&gt;	&lt;87sins7mhy.fsf@uwakimon.sk.tsukuba.ac.jp&gt;	&lt;CAJA1Y2b6XyFNsFhDbK+ktgWk0cE5Lzfv9OrhimBH8RyN78yzLQ@mail.gmail.com&gt;	&lt;87d2ew76yd.fsf@uwakimon.sk.tsukuba.ac.jp&gt;	&lt;CAJA1Y2Y2vaH06nJyt25uREjCT9RELoTnfwDpeXX5Z97W45oZUQ@mail.gmail.com&gt;	&lt;5387D422.2070302@extellisys.com&gt;	&lt;CABHGxq65zdPuC1dRof0_KjmEzuNFX2GKS3JpjJM7T-U=2PH2Tw@mail.gmail.com&gt;	&lt;CAJA1Y2YvJikn77rv3EznP=UC4nr8rT4L07RauCN7Kv3tYqD5Ew@mail.gmail.com&gt;</li>
<li>User-agent: Mozilla/5.0 (X11; Linux x86_64;	rv:24.0) Gecko/20100101 Icedove/24.5.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 2014年05月30日 23:22, Bruno Raoult wrote:
&gt; Also, and if I understood, the only issue is the number of possible opened
&gt; files per process (especially
&gt; per user, and that you are not able to change the system limits for a
&gt; specific user (=this is not your
&gt; machine)), right?

Thank you for pointing that out again, as it reminded me of practical
issues. ;)

In my implementation, each [nmerge] process has a maximum of 6 files open
at any given time, however, so it does not run into such limits.

To avoid any ARG_MAX issues, I just added a -r flag that enables
recursion.  A command such as `nmerge -r -o output.txt input` will recurse
through the input directory, merging all files found.

<a  rel="nofollow" href="https://github.com/TravisCardwell/merge/commit/22747404a7b23ad40c267131940b27b9f5e33c32">https://github.com/TravisCardwell/merge/commit/22747404a7b23ad40c267131940b27b9f5e33c32</a>

&gt; Or you have disk space limit, so you can't do simple things, such as using
&gt; double space from original files.

Note that if you want to keep the original files, then ~triple the space
is required.

&gt;  - either on #files opened (sort | uniq will work)

I am not convinced that this is an issue, as --batch-size can be used to
specify how many files are opened at once.

&gt; - either on disk space (no need to use uniq at temp stage, only at last one)

Reducing during the merge is only beneficial if the number of reductions
is significant.  If they are not significant, then the time requirements
of either are O(N log M) where N is the total number of lines and M is the
number of (roughly equal-in-size, pre-sorted) input files.

&gt; - if you don't care CPU processing limit, a small script and a small DB can
&gt; do everything (sqlite, etc...). It could be
&gt; expensive, but not so much, if the insert script makes a &quot;+1&quot; to a given
&gt; key on insert, and real-time update disabled.
&gt; You will not even need to keep the original files sorted.

The time requirements for this is O(N log N).  You no longer need to keep
input files sorted, but you gain nothing if they already are sorted.

I usually use databases for tasks such as this one, btw. :)

&gt; You will get your
&gt; output (key/number) immediately.

A select (on an indexed column) is O(log N), not immediate (O(1)).

&gt; Instead of creating a new program, I would try everything else first, to be
&gt; sure nothing is possible with existing commands...
&gt;
&gt; Just to avoid maintenance.

With tasks such as this one, which can likely be solved using a few
standard Unix utilities, I totally agree.  (My implementation was an
exercise in Go parallelization.)

In general, however, I find that shell scripts require more maintenance
than scripts/programs that are written in a more capable language.

Cheers,

Travis

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00018" href="msg00018.html">Re: [tlug] Limits on file numbers in sort -m</a></strong>
<ul><li><em>From:</em> Bruno Raoult</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00000.html">[tlug] USB3 hard disks</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00002.html">Re: [tlug] USB3 hard disks</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00014.html">Re: [tlug] USB3 hard disks</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00018.html">Re: [tlug] Limits on file numbers in sort -m</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00001"><strong>Date</strong></a></li>
<li><a href="threads.html#00001"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="/list.html"> Mailing List </a></td>
<td align=center><a href="http://tlug.jp/linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="http://tlug.jp/members.html">TLUG Members</a></td>
<td align=center><a href="http://tlug.jp//linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
