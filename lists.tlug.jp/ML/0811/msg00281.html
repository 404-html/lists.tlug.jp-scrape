<!-- MHonArc v2.6.10 -->
<!--X-Subject: [tlug] STM, the Silver Bullet, and the Foot -->
<!--X-From-R13: Qheg Enzcfba <pwfNfgneyvat&#45;fbsgjner.pbz> -->
<!--X-Date: Tue, 25 Nov 2008 22:04:23 +0900 -->
<!--X-Message-Id: 20081125130423.GF5739@smtp.office.cynic.net -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4913AFC7.3080304@articlass.org -->
<!--X-Reference: 4913B730.6030104@bebear.net -->
<!--X-Reference: 491B961D.7030709@articlass.org -->
<!--X-Reference: 20081113113655.GC2041@inferi.kami.home -->
<!--X-Reference: 491C527B.3070001@articlass.org -->
<!--X-Reference: 491CD2B8.8020605@bebear.net -->
<!--X-Reference: 491CDADA.5040806@articlass.org -->
<!--X-Reference: 491CDC68.3070209@bebear.net -->
<!--X-Reference: 30ce84360811131806w295730ajacba6f96fe02f8ee@mail.gmail.com -->
<!--X-Reference: 87vdunnm9f.fsf@xemacs.org -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00280.html">Date Prev</a>][<a href="msg00282.html">Date Next</a>][<a href="msg00178.html">Thread Prev</a>][<a href="msg00285.html">Thread Next</a>][<a href="maillist.html#00281">Date Index</a>][<a href="threads.html#00281">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[tlug] STM, the Silver Bullet, and the Foot</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Tue, 25 Nov 2008 22:04:23 +0900</li>
<li><strong>From</strong>: <strong>Curt Sampson &lt;<a href="mailto:cjs@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20STM%2C%20the%20Silver%20Bullet%2C%20and%20the%20Foot">cjs@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>[tlug] STM, the Silver Bullet, and the Foot</strong></li>
<li>References: &lt;<a href="msg00104.html">4913AFC7.3080304@articlass.org</a>&gt; &lt;<a href="msg00105.html">4913B730.6030104@bebear.net</a>&gt;	&lt;<a href="msg00144.html">491B961D.7030709@articlass.org</a>&gt;	&lt;<a href="msg00146.html">20081113113655.GC2041@inferi.kami.home</a>&gt;	&lt;<a href="msg00150.html">491C527B.3070001@articlass.org</a>&gt; &lt;<a href="msg00153.html">491CD2B8.8020605@bebear.net</a>&gt;	&lt;<a href="msg00154.html">491CDADA.5040806@articlass.org</a>&gt; &lt;<a href="msg00155.html">491CDC68.3070209@bebear.net</a>&gt;	&lt;<a href="msg00168.html">30ce84360811131806w295730ajacba6f96fe02f8ee@mail.gmail.com</a>&gt;	&lt;<a href="msg00171.html">87vdunnm9f.fsf@xemacs.org</a>&gt;</li>
<li>User-agent: Mutt/1.5.17+20080114 (2008-01-14)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 2008-11-17 12:45 +0900 (Mon), Edward Middleton wrote:

&gt; Stephen J. Turnbull wrote:
&gt; &gt; Seriously, after
&gt; &gt; the discussion with Curt re: STM in Haskell, I think this one could
&gt; &gt; happen soonish, and it seems like a solution is on the horizon.
&gt; 
&gt; I don't know,  It doesn't look like the silver bullet[1], and possible
&gt; not very applicable to a kernel[2].   Though there is a Linux kernel
&gt; supporting HTM[3].  Now all we need is hardware support ;)
&gt; 
&gt; 1. <a  href="http://portal.acm.org/citation.cfm?doid2=1400214.1400228">http://portal.acm.org/citation.cfm?doid2=1400214.1400228</a>
&gt; 2. <a  href="http://blogs.sun.com/bmc/entry/concurrency_s_shysters">http://blogs.sun.com/bmc/entry/concurrency_s_shysters</a>

Actually, my paper copy of CACM arrived a couple of days ago, and just
yesterday evening (well, now a week ago, as this incomplete message
has been languishing) I picked it up, looked through the table of
contents, and got pretty excited by the article referenced above,
entitled &quot;Software Transactional Memory: Why is it Only a Research Toy?&quot;

(Incidently, unusually for papers appearing in ACM publications,
this appears available for free download, along with a related
ACM Queue article that appeared in a shortened version in
the same issue: &lt;<a  href="http://doi2.acm.org/1454456.1454462">http://doi2.acm.org/1454456.1454462</a>&gt;. Also,
&lt;<a  href="http://x86vmm.blogspot.com/2008/11/cantrill-and-bonwick-get-all-concurrent.html">http://x86vmm.blogspot.com/2008/11/cantrill-and-bonwick-get-all-concurrent.html</a>&gt;
is relevant.

(And while we're on the topic of being able to access
ACM articles, my membership doesn't let me get to
&lt;<a  href="http://portal.acm.org/citation.cfm?doid=1366230.1366241">http://portal.acm.org/citation.cfm?doid=1366230.1366241</a>&gt;, &quot;The
limits of software transactional memory (STM): dissecting Haskell STM
applications on a many-core environment&quot;; if anybody can get me a copy,
I'd be very appreciative.)

Anyway, back to the topic: I was excited because, after all, to whack
STM down in such a major way is, for me, an incredibly interesting
research result, even if it happens to destroy a little pet theory I
rather like.

Unfortunately, the article suffers from the some of the seemingly
typical CACM quality issues that I've seen since I started receiving
it in September. The illegible graphics done by their &quot;award-winning&quot;
graphics team I can excuse; perhaps the editors had just never read
Tuft. (The graphs in this article where zero threads get just slightly
less work done than one thread are a particularly charming example.)
But it beggars the imagination to know that the ACM appears to be an
organization intent on celebrating the anniversary of LISP by still
refusing to include in their undergraduate CS curriculum recommendations
a requirement for any experience at all in a functional programming
language.

But it may be that I've seen an unrepresentative sample. After all,
the ACM did originally publish the Harris, Simons (both of them),
et al. &quot;Composable memory transactions&quot; paper in the PPoPP 2005
proceedings. (This is the famous &quot;Beautiful Concurrency&quot; paper published
in O'Reilly's 2007 _Beautiful Code_.) While searching for it, I
discovered that they'd republished it in the August 2008 CACM, and from
a quick read of a few pages it appears that there's a fair amount of
other great stuff in that issue. (Alex E. Bell's comment that, &quot;even
the most savvy must occasionally liken themselves to the infamous Neo
in the film The Matrix and gyrate wildly to avoid being stricken by the
many silver bullets whizzing by&quot; was one of the many high points in a
particularly enjoyable opinion piece.)

So, much as it pains me (not to mention making this off-topic for a
list of this sort), let's set ranting aside for a few moments, and look
at the substance of the provocatively titled article referenced as [1]
above, and how it relates to the previous Haskell STM discussion.

The first point that struck me, and probably the most important one for
the purposes of this discussion, is that this article is really all
about STM in C and similar languages.

As it turns out, neither transactional memory (the paper mentions
hardware TM and hardware-assisted TM, though it's not the focus) nor
software transactional memory is a new thing. The paper references
articles on this particular topic dating as early as 1993, and a search
of the ACM on-line publication archives for &quot;software transactional
memory&quot; brings up 275 results dating back to 1994. Adding &quot;Haskell&quot;
to the search reduces the result count to 51 dating back to the 2005
&quot;Composable Memory Transactions&quot; paper; clearly this is not some new
Haskell thing.

And the problems with STM that they bring up appear to be very good
ones--or, rather, very bad ones, if you're an STM fan. I won't get
into the details, since you can get them all from the paper, but
having written a reasonable amount of multi-threaded lock-using code
myself, and looking at the issues they describe, STM seems to me
to be far from a silver bullet. The arguments that STM's semantics
are muddled by interaction with non-transactional code and data
accessed within transactions, that programmers annotating what data
are transactional and not is difficult and error-prone, that without
significant annotations one introduces large access overheads for memory
accesses that need not be transactional, all of this rings very true to
me.

And, while I'm not going to buy the idea that Bryan Cantrill
(&quot;Concurrency's Shysters&quot;, [2] above), though a very, very smart guy*
is all-so-prescient--it appears to me to be a classic case of 20/20
hindsight when he implies that he guessed that SMP kernels would scale
well beyond 8 CPUs--I'll admit I learned a lot from that ACM Queue
article, despite some of my reservations with the general thrust of it.
(I recommend everybody read the second half of it, just in case you
happen to become a programmer one day.)

    * His response to David Miller notwithstanding:
    &lt;<a  href="http://cryptnet.net/mirrors/texts/kissedagirl.html">http://cryptnet.net/mirrors/texts/kissedagirl.html</a>&gt;. And by the
    way, I should get extra credit, as a NetBSD Sparc guy (at the time),
    for bringing up David Miller at all, much less on a Linux list. :-)

So, given all this, why is this Curt guy still raving about STM?

Well, the truth is, I'm not.

I'd understood this up to now more clearly in other areas relating to
Haskell and parallelism, but the same thing applies here. STM works in
Haskell in a way it doesn't work in other languages not because it's
STM, but because it's done in Haskell.

The key point here, and I don't know if I can explain it adequately
in a (relatively) short message in this environment, is that Haskell
is pure by default. This means that, for any particular function, it
doesn't matter when you call it (before or after another function) or
how many times you call it (never--if you don't happen to use the result
for something else, or a hundred times), the side effects are the same:
none.

To put it in more concrete terms, if I say in Haskell 'foo x y', which
is the same as 'foo(x(),y())' or '(foo (x) (y))' in your C-ish or
LISP-ish language of choice, the functions x() and y() may never be
called, or may be called multiple times (though they won't be with a
good compiler such as ghc), and it makes no difference. This is just
the standard thing Haskell, or any other pure language.

This differs significantly from modern LISP-like languages where when
you say '(foo (a) (b))', and 'foo' happens to be 'and', it's specified
that '(a)' must be evaluated before '(b)', and '(b)' must not evaluated
if '(a)' evaluates to false. (Is 'foo' a macro with special evaluation
order, as above? Or just a regular function where both '(a)' and '(b)'
will be evaluated first. You'll have to remind me.)

Of course, we do need to do I/O, and other things that have side
effects in some sort of world (even it be the limited world of, say, a
transactional model), and these things need to have their sequence of
execution specified. That, among many other things, is for what we use
monads. As it turns out, the exact same mechanism that lets us separate
impure code doing IO from side-effect-free pure code and order the IO
actions appropriately is exactly suited for the parallel case of STM.

So what do we get from this? Well, we know that programmer annotations
of what's transactional and what's not are difficult and unreliable.
That's where Haskell's type system comes in: just as with the IO
monad, it enforces the separation of these things and type-checks the
&quot;annotations.&quot; We also know that it's dangerous and error-prone to mix
abortable transactions and things with side-effects; again, the type
system deals with this, forcing you to declare what's STM, what has
side effects, and deal with mixing the two. And of course the &quot;pure by
default&quot; model of Haskell leads you to generally not mixing them.

In the end, a lot of the problems with STM described in the article seem
to me entirely parallel to the problems with lock-based systems, and
from that point of view, it really doesn't seem to offer much advantage
over locking. The problems are easy to fix only by throwing away
performance (declaring all variables to be STM variables is tantmount
to using one big lock for all program data). The big difference here is
that safe STM is expressable, in a way that locks aren't, in Haskell's
type system, and as with many other things where we use type systems,
and this eliminates many categories of programmer errors, increases
runtime efficiency, and allows easy composition of separately developed
bits of code.

The advantage lies in Haskell, not in STM.

On 2008-11-17 11:01 +0900 (Mon), Stephen J. Turnbull wrote:

&gt; The fact that even so nobody but SPJ really understands that stuff....

Actually, I'd proffer the opinion that SPJ is far from a guru when it
comes to STM, it's just that he's a master at finding abstractions that
work in sufficiently powerful languages. 

On 2008-11-17 13:32 +0900 (Mon), Stephen J. Turnbull wrote:

&gt; My point is simply that STM is an examples that suggests that people
&gt; are starting to get a handle on &quot;what really is going on here&quot;, and my
&gt; bet is that within a couple of years that will result in a solution
&gt; that deserves to go into kernels, even if its not universally
&gt; applicable.

Well, to summarize, my thought on the matter is that when it comes to
kernels, at least those not written in Haskell or something similar,
locking is likely to reign for quite some time simply because it's
better understood. So I guess, in a way, I agree with the original paper
after all.

Thoughts welcome, of course.

cjs
-- 
Curt Sampson       &lt;cjs@example.com&gt;        +81 90 7737 2974   
Mobile sites and software consulting: <a  href="http://www.starling-software.com">http://www.starling-software.com</a>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00285" href="msg00285.html">[tlug] STM, the Silver Bullet, and the Foot</a></strong>
<ul><li><em>From:</em> Stephen J. Turnbull</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00104" href="msg00104.html">[tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00105" href="msg00105.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Edward Middleton</li></ul></li>
<li><strong><a name="00144" href="msg00144.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00146" href="msg00146.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Mattia Dongili</li></ul></li>
<li><strong><a name="00150" href="msg00150.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00153" href="msg00153.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Edward Middleton</li></ul></li>
<li><strong><a name="00154" href="msg00154.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00155" href="msg00155.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Edward Middleton</li></ul></li>
<li><strong><a name="00168" href="msg00168.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Ian Wells</li></ul></li>
<li><strong><a name="00171" href="msg00171.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
<ul><li><em>From:</em> Stephen J. Turnbull</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00280.html">Re: [tlug] Looking for a distribution to replace Ubuntu</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00282.html">Re: [tlug] Re: TSAC Meeting: Thursday, November 27th 2008 -- Fibonacci	and Netflix</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00178.html">Re: [tlug] Just curious... how much impact does a kernel update make?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00285.html">[tlug] STM, the Silver Bullet, and the Foot</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00281"><strong>Date</strong></a></li>
<li><a href="threads.html#00281"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="../../list.html"> Mailing List </a></td>
<td align=center><a href="../../linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="../../members.html">TLUG Members</a></td>
<td align=center><a href="../../linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
