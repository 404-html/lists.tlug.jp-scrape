<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED] -->
<!--X-From-R13: Rneera Qbbx <qneeraNqpbbx.bet> -->
<!--X-Date: Fri, 26 Nov 2010 21:07:37 +0900 -->
<!--X-Message-Id: 4CEFA304.7070407@dcook.org -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4CEB46A8.6000202@articlass.org -->
<!--X-Reference: AANLkTikFnEpNOH6xa48Lio3e0XSGRDD9tDyJ_SM01NLv@mail.gmail.com -->
<!--X-Reference: 4CED3243.6070002@articlass.org -->
<!--X-Reference: AANLkTi=eq&#45;A8nXOXFxg63FBc4mNE1pjY&#45;v+o7g&#45;c=PVi@mail.gmail.com -->
<!--X-Reference: 87d3pubise.fsf@uwakimon.sk.tsukuba.ac.jp -->
<!--X-Reference: 4CEE84F0.3080807@articlass.org -->
<!--X-Reference: 4CEF3663.5070001@sonic.net -->
<!--X-Reference: 878w0g7j80.fsf@uwakimon.sk.tsukuba.ac.jp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00134.html">Date Prev</a>][<a href="msg00136.html">Date Next</a>][<a href="msg00134.html">Thread Prev</a>][<a href="msg00137.html">Thread Next</a>][<a href="maillist.html#00135">Date Index</a>][<a href="threads.html#00135">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Fri, 26 Nov 2010 21:07:32 +0900</li>
<li><strong>From</strong>: <strong>Darren Cook &lt;<a href="mailto:darren@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">darren@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</strong></li>
<li>References: &lt;<a href="mailto:4CEB46A8.6000202@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">4CEB46A8.6000202@example.com</a>&gt;	&lt;<a href="mailto:AANLkTikFnEpNOH6xa48Lio3e0XSGRDD9tDyJ_SM01NLv@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">AANLkTikFnEpNOH6xa48Lio3e0XSGRDD9tDyJ_SM01NLv@example.com</a>&gt;	&lt;<a href="mailto:4CED3243.6070002@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">4CED3243.6070002@example.com</a>&gt;	&lt;<a href="mailto:AANLkTi%3Deq-A8nXOXFxg63FBc4mNE1pjY-v%2Bo7g-c%3DPVi@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">AANLkTi=eq-A8nXOXFxg63FBc4mNE1pjY-v+o7g-c=PVi@example.com</a>&gt;	&lt;<a href="mailto:87d3pubise.fsf@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">87d3pubise.fsf@example.com</a>&gt;	&lt;<a href="mailto:4CEE84F0.3080807@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">4CEE84F0.3080807@example.com</a>&gt;	&lt;<a href="mailto:4CEF3663.5070001@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">4CEF3663.5070001@example.com</a>&gt;	&lt;<a href="mailto:878w0g7j80.fsf@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20Arrrg%21%20Permissions%20driving%20me%20nuts%20in%20PHP%20%5BSOLVED%5D">878w0g7j80.fsf@example.com</a>&gt;</li>
<li>User-agent: Mozilla/5.0 (X11; U; Linux x86_64; en-US;	rv:1.9.1.15) Gecko/20101027 Thunderbird/3.0.10</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>&gt;  &gt; Does umask permissions take precedence over mkdir permissions? It might 
&gt;  &gt; be worth trying a umask 0 before the mkdir command.
&gt; 
&gt; Even if it works, you don't want to do that.  It opens your system up
&gt; to potential directory traversal and trojan attacks because there's a
&gt; race condition.

I'm not sure about how you get all that exciting stuff (The manual
describes it as &quot;PHP's umask&quot;, so it only applies to PHP scripts), but
as the manual emphasizes you need to be careful in a web server as your
umask change will apply to all php scripts running in that web server.

So any other php scripts on your web server that do anything while these
three lines are being processed:
  $old=umask(0);
  mkdir($dirPath,0777);
  umask($old);

could be created with unexpected permissions.

I still think you should try it to see if works. Useful information, one
way or the other, in tracking down the problem.
(Or try Stephen's below idea first of checking/fixing permissions and
ownership on the parent directory of $dirPath.)

Darren

&gt; really wants to fix the process owner/file owner skew.  My guess is an
&gt; old owner spec of nobody for the parent directory with set-uid bit
&gt; set.  (I can't remember whether that's supposed to make files inherit
&gt; user ownership, but set-gid should work for inheriting group
&gt; ownership.)  And now apache is running under www-data or apache.  Or
&gt; something like that.


-- 
Darren Cook, Software Researcher/Developer

<a  rel="nofollow" href="http://dcook.org/gobet/">http://dcook.org/gobet/</a>  (Shodan Go Bet - who will win?)
<a  rel="nofollow" href="http://dcook.org/work/">http://dcook.org/work/</a> (About me and my work)
<a  rel="nofollow" href="http://dcook.org/blogs.html">http://dcook.org/blogs.html</a> (My blogs and articles)

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00102" href="msg00102.html">[tlug] Arrrg! Permissions driving me nuts in PHP</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00104" href="msg00104.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP</a></strong>
<ul><li><em>From:</em> Edmund Edgar</li></ul></li>
<li><strong><a name="00111" href="msg00111.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00114" href="msg00114.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP</a></strong>
<ul><li><em>From:</em> Sach Jobb</li></ul></li>
<li><strong><a name="00115" href="msg00115.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP</a></strong>
<ul><li><em>From:</em> Stephen J. Turnbull</li></ul></li>
<li><strong><a name="00128" href="msg00128.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</a></strong>
<ul><li><em>From:</em> Dave M G</li></ul></li>
<li><strong><a name="00132" href="msg00132.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</a></strong>
<ul><li><em>From:</em> s smith</li></ul></li>
<li><strong><a name="00134" href="msg00134.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</a></strong>
<ul><li><em>From:</em> Stephen J. Turnbull</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00134.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00136.html">Re: [tlug] Backup Software</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00134.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00137.html">Re: [tlug] Arrrg! Permissions driving me nuts in PHP [SOLVED]</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00135"><strong>Date</strong></a></li>
<li><a href="threads.html#00135"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="/list.html"> Mailing List </a></td>
<td align=center><a href="http://tlug.jp/linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="http://tlug.jp/members.html">TLUG Members</a></td>
<td align=center><a href="http://tlug.jp//linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
