<!-- MHonArc v2.2.0 -->
<!--X-Subject: tlug: Overwriting running executable -->
<!--X-From: Neil Booth <NeilB@example.com> -->
<!--X-Date:  Mon, 26 Oct 1998 20:26:00 +0900 -->
<!--X-Message-Id: 36345C44.C5438CA2@example.com -->
<!--X-ContentType: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-type" content="text/html">
  <meta name="Author" content="Jim Schweizer - webmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<!--X-Body-Begin-->
<!--X-User-Header-->
<P>
<font color="blue">
Support open source code!
</font>
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg01069.html">Date Prev</A>][<A HREF="msg01071.html">Date Next</A>][<A HREF="msg01171.html">Thread Prev</A>][<A HREF="msg01079.html">Thread Next</A>][<A HREF="maillist.html#01070">Date Index</A>][<A HREF="threads.html#01070">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>tlug: Overwriting running executable</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><strong>To</strong>: <strong>tlug &lt;<A HREF="mailto:tlug@example.com">tlug@example.com</A>&gt;</strong></LI>
<LI><strong>Subject</strong>: <strong>tlug: Overwriting running executable</strong></LI>
<LI><strong>From</strong>: <strong>Neil Booth &lt;<A HREF="mailto:NeilB@example.com">NeilB@example.com</A>&gt;</strong></LI>
<LI>Date: Mon, 26 Oct 1998 20:25:56 +0900</LI>
<LI>Content-Transfer-Encoding: 7bit</LI>
<LI>Content-Type: text/plain; charset=us-ascii</LI>
<LI>Organization: ...</LI>
<LI>Reply-To: <A HREF="mailto:tlug@example.com">tlug@example.com</A></LI>
<LI>Sender: <A HREF="mailto:owner-tlug@example.com">owner-tlug@example.com</A></LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
The other day, I upgraded bash from the somewhat old version they ship
with RH 5.1 (why?). Anyway, I extracted the RPM, and of course I
extracted it from a running bash shell. Coming from Windows, I was
slightly surprised to see that there were no errors about the bash
executable being in use, but didn't think about it much more apart from
a minor irritation logged at the back of my mind.

Well, on Saturday I downloaded the latest Windowmaker, and compiled
that. The install script overwrote the old executable with the new one.
I was doing all this from a windowed shell running under the old version
of Windowmaker. Again, there were no errors. More curious this time, I
checked the timestamp on the "wmaker" executable in the relevant "bin"
directory, and sure enough it was the new one.

I was suspicious, wondering what would happen if some of the Windowmaker
executable were not in memory, and a page fault were caused. I assumed
it would load in some spurious code from the new executable. But nothing
was crashing.

So how does this work? My first thought was that Linux must have to load
the full old executable into memory and mark those pages as unfreeable
until their reference count becomes zero.

Then I had a more devious idea. Maybe the old executable is still on the
disk, but is just no longer referenced by any directory entries. Its
inode's reference count would be still be non-zero, the reference being
the currently running instance of the old executable. But then as soon
as WM is exited, the inode's reference count is decremented to zero and
the space on the filesystem becomes free. This method would avoid the
need to bring the whole image into memory and mark it as semi-permanent,
as it is still on the disk.

I suspect this latter way is what happens in practice. Can anyone
confirm?

And why doesn't Windows (even NT) do it this way? It seems so much
cleaner, in that all processes get to do what they want without errors,
than marking files such as DLLs as read-only when in use the way Windows
appears to.

Neil.

--------------------------------------------------
Pile up the benefits that accrue from studying
by the light of fireflies reflected on the snow...
---------------------------------------------------------------
Next Nomikai: 20 November, 19:30 Tengu TokyoEkiMae 03-3275-3691
Next Technical Meeting: January, 1999 (details TBA)
---------------------------------------------------------------
Sponsor: PHT, makers of TurboLinux <A TARGET="_top" HREF="http://www.pht.co.jp">http://www.pht.co.jp</A>

</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="01079" HREF="msg01079.html">tlug: Overwriting running executable</A></STRONG>
<UL><LI><EM>From:</EM> "Stephen J. Turnbull" &lt;turnbull@example.com&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg01069.html">Re: tlug: RE: Mounting my cdrom's</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg01071.html">tlug: Mounting my cdrom's</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg01171.html">Re: tlug: Mounting my cdrom's</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg01079.html">tlug: Overwriting running executable</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="maillist.html#01070"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#01070"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="../../list.html"> Mailing List </a></td>
<td align=center><a href="../../linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="../../members.html">TLUG Members</a></td>
<td align=center><a href="../../linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
