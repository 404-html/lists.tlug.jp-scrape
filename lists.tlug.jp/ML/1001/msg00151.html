<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: [tlug] how to tune reiser4 for millions of files? -->
<!--X-From-R13: Qheg Enzcfba <pwfNfgneyvat&#45;fbsgjner.pbz> -->
<!--X-Date: Sun, 31 Jan 2010 15:43:16 +0900 -->
<!--X-Message-Id: 20100131064316.GC13956@poetic.cynic.net -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20100128095957.GB24344@analytic.cynic.net -->
<!--X-Reference: 20100128132701.GI13095@wasi.karlov.mff.cuni.cz -->
<!--X-Reference: 87wrz2s08d.fsf@xemacs.org -->
<!--X-Reference: 20100128180431.GA10687@OZoNE.TZoNE.ORG -->
<!--X-Reference: 20100129134613.GA18169@wasi.karlov.mff.cuni.cz -->
<!--X-Reference: 20100128073847.GH13095@wasi.karlov.mff.cuni.cz -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>TLUG Mailing List</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="Author" content="Jim Tittsler - listmaster TLUG">
  <meta http-equiv="keywords" content="Tokyo Linux Users Group mailing list archive.">
</head>
 
<body bgcolor="#FFFFFF" text="#000000" BACKGROUND="../back3grnd.gif">
<BLOCKQUOTE>
<CENTER><IMG SRC="../tlug_logo.gif"><BR>Mailing List Archive</CENTER>
<P>
<TABLE BGCOLOR="#FFFF66" BORDER=1 COLS=1 WIDTH="90%" CLASS=navbar>
<TR>
<TD>&nbsp;&nbsp;
<FONT FACE="Verdana, Lucida Sans, Arial, Helvetica, Geneva, sans-serif"><SMALL>
<A HREF="../../index.html" TITLE="Tokyo Linux Users Group Page">
<STRONG>tlug.jp</STRONG></A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../../list.html" TITLE="Mailing List Page">Mailing List</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
<A HREF="../index.html" TITLE="tlug Archive Page">tlug archive</A> 
<IMG SRC="../../images/arrow_yellow.gif" WIDTH=13 HEIGHT=9 ALIGN=bottom ALT="-&gt;">
tlug Mailing List Archive
</SMALL></FONT>
</TD></TR>
</TABLE>
<P>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00150.html">Date Prev</a>][<a href="msg00152.html">Date Next</a>][<a href="msg00155.html">Thread Prev</a>][<a href="msg00138.html">Thread Next</a>][<a href="maillist.html#00151">Date Index</a>][<a href="threads.html#00151">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [tlug] how to tune reiser4 for millions of files?</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li>Date: Sun, 31 Jan 2010 15:43:16 +0900</li>
<li><strong>From</strong>: <strong>Curt Sampson &lt;<a href="mailto:cjs@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">cjs@example.com</a>&gt;</strong></li>
<li><strong>Subject</strong>: <strong>Re: [tlug] how to tune reiser4 for millions of files?</strong></li>
<li>References: &lt;<a href="mailto:20100128095957.GB24344@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128095957.GB24344@example.com</a>&gt;	&lt;<a href="mailto:20100128132701.GI13095@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128132701.GI13095@example.com</a>&gt;	&lt;<a href="mailto:87wrz2s08d.fsf@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">87wrz2s08d.fsf@example.com</a>&gt;	&lt;<a href="mailto:20100128180431.GA10687@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128180431.GA10687@example.com</a>&gt;	&lt;<a href="mailto:20100129134613.GA18169@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100129134613.GA18169@example.com</a>&gt;	&lt;<a href="mailto:20100128073847.GH13095@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128073847.GH13095@example.com</a>&gt;	&lt;<a href="mailto:20100128095957.GB24344@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128095957.GB24344@example.com</a>&gt;	&lt;<a href="mailto:20100128132701.GI13095@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128132701.GI13095@example.com</a>&gt;	&lt;<a href="mailto:87wrz2s08d.fsf@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">87wrz2s08d.fsf@example.com</a>&gt;	&lt;<a href="mailto:20100128180431.GA10687@DOMAIN.HIDDEN?SUBJECT=Re:%20%5Btlug%5D%20how%20to%20tune%20reiser4%20for%20millions%20of%20files%3F">20100128180431.GA10687@example.com</a>&gt;</li>
<li>User-agent: Mutt/1.5.18 (2008-05-17)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 2010-01-28 13:04 -0500 (Thu), Patrick Bernier wrote:

&gt; I would tend to guess that his ls is trying to SORT the entire file listing
&gt; before printing anything, which of course cannot be done before having
&gt; loaded the ENTIRE file list in memory.

That's a good thought, but loading the entire file list into memory is a
relatively cheap operation, since it's a linear read of a file (on UFS,
anyway--it's probably a still relatively cheap tree scan on Reiser), and
the sort will be quite cheap assuming it stays in main memory.

The expensive (i.e., time-consuming) thing will be the IO to pull in all
of the inode information, since that's going to have to go all over the
disk looking for it.

You can quite easily compare the effects of the various operations:

    ls -1 -U	# no sort, no inode lookup
    ls -1	# sorted,  no inode lookup
    ls -1 -l -U # no sort, inode lookups
    ls -1 -l    # sorted,  inode lookups

Note that I use (-1) here to avoid the buffering and various processing
necessary to columnize the output.

&gt; ...using &quot;find&quot; is always the fastest way to go...

Actually, as well as being simpler, &quot;ls -1 -U&quot; will be faster due to
avoding the overhead of forking off all these &quot;ls&quot; processes. On modern
machines it's not likely you will notice this.

On 2010-01-29 14:46 +0100 (Fri), Michal Hajek wrote:

&gt; &gt; 	find . -print0 | xargs -0 -r -- ls -l
&gt; 
&gt; this yields the result in something like 30 min, which is a great
&gt; improvement compared to those 6+ hours which I spent with simple &quot;ls -l&quot;...

Interesting. What you're doing here is the equivalant of &quot;ls -1 -l -U&quot;
above. Why is it so much faster when unsorted, though it is doing inode
lookups?

Let me guess: the files were created in sequence without a large amount
of other filesystem activity in between, and were not created in
alphebetical order. If you create, write and close a large number of
small files in sequence on a UFS-style file system, they inode entries
for two files created one after the other will tend to be written side
by side in the same block. Thus, when you look up those two inode
entries one after the other, the second is already in a block in the
buffer cache, and you need not go to disk for it.

When you read the inode entries in order of filename, rather than
creation, you're effectively reading them back in random order and thus
you have standard &quot;random I/O is slow&quot; problem.

My thoughts on solutions in a separate post.

cjs
-- 
Curt Sampson         &lt;cjs@example.com&gt;         +81 90 7737 2974
             <a  rel="nofollow" href="http://www.starling-software.com">http://www.starling-software.com</a>
The power of accurate observation is commonly called cynicism
by those who have not got it.    --George Bernard Shaw

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00127" href="msg00127.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
<ul><li><em>From:</em> Curt Sampson</li></ul></li>
<li><strong><a name="00128" href="msg00128.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
<ul><li><em>From:</em> Michal Hajek</li></ul></li>
<li><strong><a name="00130" href="msg00130.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
<ul><li><em>From:</em> Stephen J. Turnbull</li></ul></li>
<li><strong><a name="00131" href="msg00131.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
<ul><li><em>From:</em> Patrick Bernier</li></ul></li>
<li><strong><a name="00139" href="msg00139.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
<ul><li><em>From:</em> Michal Hajek</li></ul></li>
<li><strong><a name="00126" href="msg00126.html">[tlug] how to tune reiser4 for millions of files?</a></strong>
<ul><li><em>From:</em> Michal Hajek</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00150.html">Re: [tlug] OSS network visualization software,	WAS: [Semi-OT]	Network  connectivity diagnosis</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00152.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00155.html">Re: [tlug] how to tune reiser4 for millions of files?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00138.html">[tlug] Looking for Accounting software</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00151"><strong>Date</strong></a></li>
<li><a href="threads.html#00151"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<strong>
<a href="../index.html">Home</a> |
<a href="maillist.html">Main Index</a> |
<a href="threads.html">Thread Index</a>
</strong>
<!--X-User-Footer-End-->
 
<P>
<CENTER>
 <table border=2 width=75%><tr><td align=center>
<a href="../../index.html"> Home Page</a></td>
<td align=center><a href="/list.html"> Mailing List </a></td>
<td align=center><a href="http://tlug.jp/linuxinjapan.html"> Linux and Japan </a></td>
<td align=center><a href="http://tlug.jp/members.html">TLUG Members</a></td>
<td align=center><a href="http://tlug.jp//linuxlinks.html">Links</a></td>
</tr></TABLE>
<P>
</CENTER>
</BLOCKQUOTE>
</body>
</html>
